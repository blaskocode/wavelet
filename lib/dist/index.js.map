{"version":3,"file":"index.js","sources":["../src/renderer/conversion.ts","../src/helper/math.ts","../src/processor/logger.ts","../src/processor/SampleTable.ts","../../node_modules/midifile-ts/dist/index.js","../src/processor/SynthEventHandler.ts","../src/processor/insertSorted.ts","../src/processor/SynthEventScheduler.ts","../src/processor/AmplitudeEnvelope.ts","../src/processor/LFO.ts","../src/processor/WavetableOscillator.ts","../src/processor/SynthProcessorCore.ts","../src/renderer/renderAudio.ts","../../node_modules/@ryohey/sf2parser/bin/index.js","../src/soundfont/getInstrumentZones.ts","../src/soundfont/getPresetZones.ts","../src/soundfont/loader.ts","../src/SynthEvent.ts"],"sourcesContent":["import { AudioData } from \"./message\"\n\nexport const audioDataToAudioBuffer = (audioData: AudioData): AudioBuffer => {\n  const audioBuffer = new AudioBuffer({\n    length: audioData.length,\n    sampleRate: audioData.sampleRate,\n    numberOfChannels: 2,\n  })\n  audioBuffer.copyToChannel(new Float32Array(audioData.leftData), 0)\n  audioBuffer.copyToChannel(new Float32Array(audioData.rightData), 1)\n  return audioBuffer\n}\n","/**\n * This is a custom implementation of Math.max to prevent call stack size exceeded error\n *   when using Math.max(...arr).\n */\nexport function max(arr: number[]): number | undefined {\n  if (arr.length === 0) {\n    return undefined\n  }\n  let max = arr[0]\n  for (let i = 1; i < arr.length; i++) {\n    if (arr[i] > max) {\n      max = arr[i]\n    }\n  }\n  return max\n}\n","export class Logger {\n  enabled = true\n\n  log(...args: any) {\n    if (this.enabled) {\n      console.log(...args)\n    }\n  }\n\n  warn(...args: any) {\n    if (this.enabled) {\n      console.warn(...args)\n    }\n  }\n\n  error(...args: any) {\n    if (this.enabled) {\n      console.error(...args)\n    }\n  }\n}\n\nexport const logger = new Logger()\nlogger.enabled = false\n","import { SampleParameter, SampleRange } from \"../SynthEvent\"\n\nexport type SampleTableItem = SampleParameter & {\n  velRange: [number, number]\n}\n\nexport type Sample = SampleParameter & {\n  buffer: Float32Array\n}\n\nexport class SampleTable {\n  private samples: {\n    [sampleID: number]: Float32Array\n  } = {}\n\n  private sampleParameters: {\n    [bank: number]: {\n      [instrument: number]: { [pitch: number]: SampleTableItem[] }\n    }\n  } = {}\n\n  addSample(data: Float32Array, sampleID: number) {\n    this.samples[sampleID] = data\n  }\n\n  addSampleParameter(parameter: SampleParameter, range: SampleRange) {\n    const { bank, instrument, keyRange, velRange } = range\n    for (let i = keyRange[0]; i <= keyRange[1]; i++) {\n      if (this.sampleParameters[bank] === undefined) {\n        this.sampleParameters[bank] = {}\n      }\n      if (this.sampleParameters[bank][instrument] === undefined) {\n        this.sampleParameters[bank][instrument] = {}\n      }\n      if (this.sampleParameters[bank][instrument][i] === undefined) {\n        this.sampleParameters[bank][instrument][i] = []\n      }\n      this.sampleParameters[bank][instrument][i].push({\n        ...parameter,\n        velRange,\n      })\n    }\n  }\n\n  getSamples(\n    bank: number,\n    instrument: number,\n    pitch: number,\n    velocity: number\n  ): Sample[] {\n    const instrumentParameters =\n      this.sampleParameters[bank]?.[instrument] ??\n      this.sampleParameters[0]?.[instrument] ?? // fallback to bank 0\n      null\n\n    const parameters =\n      instrumentParameters?.[pitch]?.filter(\n        (s) => velocity >= s.velRange[0] && velocity <= s.velRange[1]\n      ) ?? []\n\n    const samples: Sample[] = []\n\n    for (const parameter of parameters) {\n      const buffer = this.samples[parameter.sampleID]\n      if (buffer === undefined) {\n        console.warn(`sample not found: ${parameter.sampleID}`)\n        continue\n      }\n      samples.push({\n        ...parameter,\n        buffer,\n      })\n    }\n\n    return samples\n  }\n}\n","var MIDIChannelEvents = {\n    noteOff: 0x08,\n    noteOn: 0x09,\n    noteAftertouch: 0x0a,\n    controller: 0x0b,\n    programChange: 0x0c,\n    channelAftertouch: 0x0d,\n    pitchBend: 0x0e,\n};\n\nvar MIDIControlEventNames = [\n    \"Bank Select\",\n    \"Modulation\",\n    \"Breath Controller\",\n    \"Undefined\",\n    \"Foot Pedal\",\n    \"Portamento Time\",\n    \"Data Entry\",\n    \"Volume\",\n    \"Undefined\",\n    \"Balance\",\n    \"Pan\",\n    \"Expression\",\n    \"Effect Control 1\",\n    \"Effect Control 2\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Ribbon Controller or General Purpose Slider 1\",\n    \"Knob 1 or General Purpose Slider 2\",\n    \"General Purpose Slider 3\",\n    \"Knob 2 or General Purpose Slider 4\",\n    \"Knob 3 or Undefined\",\n    \"Knob 4 or Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Bank Select\",\n    \"Modulation Wheel\",\n    \"Breath controller\",\n    \"Undefined\",\n    \"Foot Pedal\",\n    \"Portamento Time\",\n    \"Data Entry\",\n    \"Volume\",\n    \"Balance\",\n    \"Undefined\",\n    \"Pan position\",\n    \"Expression\",\n    \"Effect Control 1\",\n    \"Effect Control 2\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Hold Pedal\",\n    \"Portamento\",\n    \"Sustenuto Pedal\",\n    \"Soft Pedal\",\n    \"Legato Pedal\",\n    \"Hold 2 Pedal\",\n    \"Sound Variation\",\n    \"Resonance\",\n    \"Sound Release Time\",\n    \"Sound Attack Time\",\n    \"Frequency Cutoff\",\n    \"Sound Control 6\",\n    \"Sound Control 7\",\n    \"Sound Control 8\",\n    \"Sound Control 9\",\n    \"Sound Control 10\",\n    \"Decay\",\n    \"High Pass Filter Frequency\",\n    \"General Purpose Button 3\",\n    \"General Purpose Button 4\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Reverb Level\",\n    \"Tremolo Level\",\n    \"Chorus Level\",\n    \"Detune\",\n    \"Phaser Level\",\n    \"Data Button Increment\",\n    \"Data Button Decrement\",\n    \"NRPN (LSB)\",\n    \"NRPN (MSB)\",\n    \"RPN (LSB)\",\n    \"RPN (MSB)\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"Undefined\",\n    \"All Sound Off\",\n    \"All Controllers Off\",\n    \"Local Keyboard\",\n    \"All Notes Off\",\n    \"Omni Mode Off\",\n    \"Omni Mode On\",\n    \"Mono Operation\",\n    \"Poly Operation\", // CC127\n];\n\nvar MIDIControlEvents = {\n    MSB_BANK: 0x00,\n    MSB_MODWHEEL: 0x01,\n    MSB_BREATH: 0x02,\n    MSB_FOOT: 0x04,\n    MSB_PORTAMENTO_TIME: 0x05,\n    MSB_DATA_ENTRY: 0x06,\n    MSB_MAIN_VOLUME: 0x07,\n    MSB_BALANCE: 0x08,\n    MSB_PAN: 0x0a,\n    MSB_EXPRESSION: 0x0b,\n    MSB_EFFECT1: 0x0c,\n    MSB_EFFECT2: 0x0d,\n    MSB_GENERAL_PURPOSE1: 0x10,\n    MSB_GENERAL_PURPOSE2: 0x11,\n    MSB_GENERAL_PURPOSE3: 0x12,\n    MSB_GENERAL_PURPOSE4: 0x13,\n    LSB_BANK: 0x20,\n    LSB_MODWHEEL: 0x21,\n    LSB_BREATH: 0x22,\n    LSB_FOOT: 0x24,\n    LSB_PORTAMENTO_TIME: 0x25,\n    LSB_DATA_ENTRY: 0x26,\n    LSB_MAIN_VOLUME: 0x27,\n    LSB_BALANCE: 0x28,\n    LSB_PAN: 0x2a,\n    LSB_EXPRESSION: 0x2b,\n    LSB_EFFECT1: 0x2c,\n    LSB_EFFECT2: 0x2d,\n    LSB_GENERAL_PURPOSE1: 0x30,\n    LSB_GENERAL_PURPOSE2: 0x31,\n    LSB_GENERAL_PURPOSE3: 0x32,\n    LSB_GENERAL_PURPOSE4: 0x33,\n    SUSTAIN: 0x40,\n    PORTAMENTO: 0x41,\n    SOSTENUTO: 0x42,\n    SUSTENUTO: 0x42,\n    SOFT_PEDAL: 0x43,\n    LEGATO_FOOTSWITCH: 0x44,\n    HOLD2: 0x45,\n    SC1_SOUND_VARIATION: 0x46,\n    SC2_TIMBRE: 0x47,\n    SC3_RELEASE_TIME: 0x48,\n    SC4_ATTACK_TIME: 0x49,\n    SC5_BRIGHTNESS: 0x4a,\n    SC6: 0x4b,\n    SC7: 0x4c,\n    SC8: 0x4d,\n    SC9: 0x4e,\n    SC10: 0x4f,\n    GENERAL_PURPOSE5: 0x50,\n    GENERAL_PURPOSE6: 0x51,\n    GENERAL_PURPOSE7: 0x52,\n    GENERAL_PURPOSE8: 0x53,\n    PORTAMENTO_CONTROL: 0x54,\n    E1_REVERB_DEPTH: 0x5b,\n    E2_TREMOLO_DEPTH: 0x5c,\n    E3_CHORUS_DEPTH: 0x5d,\n    E4_DETUNE_DEPTH: 0x5e,\n    E5_PHASER_DEPTH: 0x5f,\n    DATA_INCREMENT: 0x60,\n    DATA_DECREMENT: 0x61,\n    NONREG_PARM_NUM_LSB: 0x62,\n    NONREG_PARM_NUM_MSB: 0x63,\n    REGIST_PARM_NUM_LSB: 0x64,\n    REGIST_PARM_NUM_MSB: 0x65,\n    ALL_SOUNDS_OFF: 0x78,\n    RESET_CONTROLLERS: 0x79,\n    LOCAL_CONTROL_SWITCH: 0x7a,\n    ALL_NOTES_OFF: 0x7b,\n    OMNI_OFF: 0x7c,\n    OMNI_ON: 0x7d,\n    MONO1: 0x7e,\n    MONO2: 0x7f,\n};\n\nvar MIDIMetaEventNames = {\n    0x00: \"sequenceNumber\",\n    0x01: \"text\",\n    0x02: \"copyrightNotice\",\n    0x03: \"trackName\",\n    0x04: \"instrumentName\",\n    0x05: \"lyrics\",\n    0x06: \"marker\",\n    0x07: \"cuePoint\",\n    0x20: \"midiChannelPrefix\",\n    0x21: \"portPrefix\",\n    0x2f: \"endOfTrack\",\n    0x51: \"setTempo\",\n    0x54: \"smpteOffset\",\n    0x58: \"timeSignature\",\n    0x59: \"keySignature\",\n    0x7f: \"sequencerSpecific\",\n};\n\nvar MIDIMetaEvents = {\n    sequenceNumber: 0x00,\n    text: 0x01,\n    copyrightNotice: 0x02,\n    trackName: 0x03,\n    instrumentName: 0x04,\n    lyrics: 0x05,\n    marker: 0x06,\n    cuePoint: 0x07,\n    midiChannelPrefix: 0x20,\n    portPrefix: 0x21,\n    endOfTrack: 0x2f,\n    setTempo: 0x51,\n    smpteOffset: 0x54,\n    timeSignature: 0x58,\n    keySignature: 0x59,\n    sequencerSpecific: 0x7f,\n};\n\nfunction deserialize(stream, lastEventTypeByte, setLastEventTypeByte) {\n    if (lastEventTypeByte === void 0) { lastEventTypeByte = 0; }\n    var deltaTime = stream.readVarInt();\n    return deserializeSingleEvent(stream, deltaTime, lastEventTypeByte, setLastEventTypeByte);\n}\nfunction deserializeSingleEvent(stream, deltaTime, lastEventTypeByte, setLastEventTypeByte) {\n    if (deltaTime === void 0) { deltaTime = 0; }\n    if (lastEventTypeByte === void 0) { lastEventTypeByte = 0; }\n    var eventTypeByte = stream.readInt8();\n    if ((eventTypeByte & 0xf0) === 0xf0) {\n        /* system / meta event */\n        if (eventTypeByte === 0xff) {\n            /* meta event */\n            var type = \"meta\";\n            var subtypeByte = stream.readInt8();\n            var length = stream.readVarInt();\n            switch (subtypeByte) {\n                case MIDIMetaEvents.sequenceNumber:\n                    if (length !== 2)\n                        throw new Error(\"Expected length for sequenceNumber event is 2, got \" + length);\n                    return {\n                        deltaTime: deltaTime,\n                        type: type,\n                        subtype: \"sequenceNumber\",\n                        number: stream.readInt16(),\n                    };\n                case MIDIMetaEvents.text:\n                    return {\n                        deltaTime: deltaTime,\n                        type: type,\n                        subtype: \"text\",\n                        text: stream.readStr(length),\n                    };\n                case MIDIMetaEvents.copyrightNotice:\n                    return {\n                        deltaTime: deltaTime,\n                        type: type,\n                        subtype: \"copyrightNotice\",\n                        text: stream.readStr(length),\n                    };\n                case MIDIMetaEvents.trackName:\n                    return {\n                        deltaTime: deltaTime,\n                        type: type,\n                        subtype: \"trackName\",\n                        text: stream.readStr(length),\n                    };\n                case MIDIMetaEvents.instrumentName:\n                    return {\n                        deltaTime: deltaTime,\n                        type: type,\n                        subtype: \"instrumentName\",\n                        text: stream.readStr(length),\n                    };\n                case MIDIMetaEvents.lyrics:\n                    return {\n                        deltaTime: deltaTime,\n                        type: type,\n                        subtype: \"lyrics\",\n                        text: stream.readStr(length),\n                    };\n                case MIDIMetaEvents.marker:\n                    return {\n                        deltaTime: deltaTime,\n                        type: type,\n                        subtype: \"marker\",\n                        text: stream.readStr(length),\n                    };\n                case MIDIMetaEvents.cuePoint:\n                    return {\n                        deltaTime: deltaTime,\n                        type: type,\n                        subtype: \"cuePoint\",\n                        text: stream.readStr(length),\n                    };\n                case MIDIMetaEvents.midiChannelPrefix:\n                    if (length !== 1)\n                        throw new Error(\"Expected length for midiChannelPrefix event is 1, got \" + length);\n                    return {\n                        deltaTime: deltaTime,\n                        type: type,\n                        subtype: \"midiChannelPrefix\",\n                        value: stream.readInt8(),\n                    };\n                case MIDIMetaEvents.portPrefix:\n                    if (length !== 1)\n                        throw new Error(\"Expected length for midiChannelPrefix event is 1, got \" + length);\n                    return {\n                        deltaTime: deltaTime,\n                        type: type,\n                        subtype: \"portPrefix\",\n                        port: stream.readInt8(),\n                    };\n                case MIDIMetaEvents.endOfTrack:\n                    if (length !== 0)\n                        throw new Error(\"Expected length for endOfTrack event is 0, got \" + length);\n                    return {\n                        deltaTime: deltaTime,\n                        type: type,\n                        subtype: \"endOfTrack\",\n                    };\n                case MIDIMetaEvents.setTempo:\n                    if (length !== 3)\n                        throw new Error(\"Expected length for setTempo event is 3, got \" + length);\n                    return {\n                        deltaTime: deltaTime,\n                        type: type,\n                        subtype: \"setTempo\",\n                        microsecondsPerBeat: (stream.readInt8() << 16) +\n                            (stream.readInt8() << 8) +\n                            stream.readInt8(),\n                    };\n                case MIDIMetaEvents.smpteOffset: {\n                    if (length !== 5)\n                        throw new Error(\"Expected length for smpteOffset event is 5, got \" + length);\n                    var hourByte = stream.readInt8();\n                    var table = {\n                        0x00: 24,\n                        0x20: 25,\n                        0x40: 29,\n                        0x60: 30,\n                    };\n                    return {\n                        deltaTime: deltaTime,\n                        type: type,\n                        subtype: \"smpteOffset\",\n                        frameRate: table[hourByte & 0x60],\n                        hour: hourByte & 0x1f,\n                        min: stream.readInt8(),\n                        sec: stream.readInt8(),\n                        frame: stream.readInt8(),\n                        subframe: stream.readInt8(),\n                    };\n                }\n                case MIDIMetaEvents.timeSignature:\n                    if (length !== 4)\n                        throw new Error(\"Expected length for timeSignature event is 4, got \" + length);\n                    return {\n                        deltaTime: deltaTime,\n                        type: type,\n                        subtype: \"timeSignature\",\n                        numerator: stream.readInt8(),\n                        denominator: Math.pow(2, stream.readInt8()),\n                        metronome: stream.readInt8(),\n                        thirtyseconds: stream.readInt8(),\n                    };\n                case MIDIMetaEvents.keySignature:\n                    if (length !== 2)\n                        throw new Error(\"Expected length for keySignature event is 2, got \" + length);\n                    return {\n                        deltaTime: deltaTime,\n                        type: type,\n                        subtype: \"keySignature\",\n                        key: stream.readInt8(true),\n                        scale: stream.readInt8(),\n                    };\n                case MIDIMetaEvents.sequencerSpecific:\n                    return {\n                        deltaTime: deltaTime,\n                        type: type,\n                        subtype: \"sequencerSpecific\",\n                        data: stream.read(length),\n                    };\n                default:\n                    return {\n                        deltaTime: deltaTime,\n                        type: type,\n                        subtype: \"unknown\",\n                        data: stream.read(length),\n                    };\n            }\n        }\n        else if (eventTypeByte === 0xf0) {\n            var length = stream.readVarInt();\n            return {\n                deltaTime: deltaTime,\n                type: \"sysEx\",\n                data: stream.read(length),\n            };\n        }\n        else if (eventTypeByte === 0xf7) {\n            var length = stream.readVarInt();\n            return {\n                deltaTime: deltaTime,\n                type: \"dividedSysEx\",\n                data: stream.read(length),\n            };\n        }\n        else {\n            throw new Error(\"Unrecognised MIDI event type byte: \" + eventTypeByte);\n        }\n    }\n    else {\n        /* channel event */\n        var param1 = void 0;\n        if ((eventTypeByte & 0x80) === 0) {\n            /* running status - reuse lastEventTypeByte as the event type.\n              eventTypeByte is actually the first parameter\n            */\n            param1 = eventTypeByte;\n            eventTypeByte = lastEventTypeByte;\n        }\n        else {\n            param1 = stream.readInt8();\n            setLastEventTypeByte === null || setLastEventTypeByte === void 0 ? void 0 : setLastEventTypeByte(eventTypeByte);\n        }\n        var eventType = eventTypeByte >> 4;\n        var channel = eventTypeByte & 0x0f;\n        var type = \"channel\";\n        switch (eventType) {\n            case MIDIChannelEvents.noteOff:\n                return {\n                    deltaTime: deltaTime,\n                    type: type,\n                    channel: channel,\n                    subtype: \"noteOff\",\n                    noteNumber: param1,\n                    velocity: stream.readInt8(),\n                };\n            case MIDIChannelEvents.noteOn: {\n                var velocity = stream.readInt8();\n                return {\n                    deltaTime: deltaTime,\n                    type: type,\n                    channel: channel,\n                    subtype: velocity === 0 ? \"noteOff\" : \"noteOn\",\n                    noteNumber: param1,\n                    velocity: velocity,\n                };\n            }\n            case MIDIChannelEvents.noteAftertouch:\n                return {\n                    deltaTime: deltaTime,\n                    type: type,\n                    channel: channel,\n                    subtype: \"noteAftertouch\",\n                    noteNumber: param1,\n                    amount: stream.readInt8(),\n                };\n            case MIDIChannelEvents.controller:\n                return {\n                    deltaTime: deltaTime,\n                    type: type,\n                    channel: channel,\n                    subtype: \"controller\",\n                    controllerType: param1,\n                    value: stream.readInt8(),\n                };\n            case MIDIChannelEvents.programChange:\n                return {\n                    deltaTime: deltaTime,\n                    type: type,\n                    channel: channel,\n                    subtype: \"programChange\",\n                    value: param1,\n                };\n            case MIDIChannelEvents.channelAftertouch:\n                return {\n                    deltaTime: deltaTime,\n                    type: type,\n                    channel: channel,\n                    subtype: \"channelAftertouch\",\n                    amount: param1,\n                };\n            case MIDIChannelEvents.pitchBend:\n                return {\n                    deltaTime: deltaTime,\n                    type: type,\n                    channel: channel,\n                    subtype: \"pitchBend\",\n                    value: param1 + (stream.readInt8() << 7),\n                };\n            default:\n                return {\n                    deltaTime: deltaTime,\n                    type: type,\n                    channel: channel,\n                    subtype: \"unknown\",\n                    data: stream.readInt8(),\n                };\n        }\n    }\n}\n\n/* Wrapper for accessing strings through sequential reads */\nvar Stream = /** @class */ (function () {\n    function Stream(buf) {\n        this.position = 0;\n        if (buf instanceof DataView) {\n            this.buf = buf;\n        }\n        else if (buf instanceof ArrayBuffer) {\n            this.buf = new DataView(buf);\n        }\n        else if (buf instanceof Array) {\n            this.buf = new DataView(new Uint8Array(buf).buffer);\n        }\n        else if (buf instanceof Uint8Array) {\n            this.buf = new DataView(buf.buffer);\n        }\n        else {\n            throw new Error(\"not supported type: \" + typeof buf);\n        }\n    }\n    Stream.prototype.readByte = function () {\n        return this.buf.getUint8(this.position++);\n    };\n    Stream.prototype.readStr = function (length) {\n        return this.read(length)\n            .map(function (e) { return String.fromCharCode(e); })\n            .join(\"\");\n    };\n    Stream.prototype.read = function (length) {\n        var result = [];\n        for (var index = 0; index < length; index++) {\n            result.push(this.readByte());\n        }\n        return result;\n    };\n    /* read a big-endian 32-bit integer */\n    Stream.prototype.readInt32 = function () {\n        var result = this.buf.getInt32(this.position, false);\n        this.position += 4;\n        return result;\n    };\n    /* read a big-endian 16-bit integer */\n    Stream.prototype.readInt16 = function () {\n        var result = this.buf.getInt16(this.position, false);\n        this.position += 2;\n        return result;\n    };\n    /* read an 8-bit integer */\n    Stream.prototype.readInt8 = function (signed) {\n        if (signed === void 0) { signed = false; }\n        if (signed) {\n            return this.buf.getInt8(this.position++);\n        }\n        else {\n            return this.readByte();\n        }\n    };\n    Stream.prototype.eof = function () {\n        return this.position >= this.buf.byteLength;\n    };\n    /* read a MIDI-style variable-length integer\n      (big-endian value in groups of 7 bits,\n      with top bit set to signify that another byte follows)\n    */\n    Stream.prototype.readVarInt = function () {\n        var result = 0;\n        for (;;) {\n            var b = this.readInt8();\n            if (b & 0x80) {\n                result += b & 0x7f;\n                result <<= 7;\n            }\n            else {\n                /* b is the last byte */\n                return result + b;\n            }\n        }\n    };\n    return Stream;\n}());\n\n/*\nclass to parse the .mid file format\n(depends on stream.js)\n*/\nfunction read(data) {\n    function readChunk(stream) {\n        var id = stream.readStr(4);\n        var length = stream.readInt32();\n        return {\n            id: id,\n            length: length,\n            data: stream.read(length),\n        };\n    }\n    var stream = new Stream(data);\n    var headerChunk = readChunk(stream);\n    if (headerChunk.id !== \"MThd\" || headerChunk.length !== 6) {\n        throw new Error(\"Bad .mid file - header not found\");\n    }\n    var headerStream = new Stream(headerChunk.data);\n    var formatType = headerStream.readInt16();\n    var trackCount = headerStream.readInt16();\n    var timeDivision = headerStream.readInt16();\n    var ticksPerBeat;\n    if (timeDivision & 0x8000) {\n        throw new Error(\"Expressing time division in SMTPE frames is not supported yet\");\n    }\n    else {\n        ticksPerBeat = timeDivision;\n    }\n    var header = {\n        formatType: formatType,\n        trackCount: trackCount,\n        ticksPerBeat: ticksPerBeat,\n    };\n    var lastEventTypeByte;\n    function readEvent(stream) {\n        return deserialize(stream, lastEventTypeByte, function (byte) { return (lastEventTypeByte = byte); });\n    }\n    var tracks = [];\n    for (var i = 0; i < header.trackCount; i++) {\n        tracks[i] = [];\n        var trackChunk = readChunk(stream);\n        if (trackChunk.id !== \"MTrk\") {\n            throw new Error(\"Unexpected chunk - expected MTrk, got \" + trackChunk.id);\n        }\n        var trackStream = new Stream(trackChunk.data);\n        while (!trackStream.eof()) {\n            var event = readEvent(trackStream);\n            tracks[i].push(event);\n        }\n    }\n    return {\n        header: header,\n        tracks: tracks,\n    };\n}\n\nfunction toCharCodes(str) {\n    var bytes = [];\n    for (var i = 0; i < str.length; i++) {\n        bytes.push(str.charCodeAt(i));\n    }\n    return bytes;\n}\n\n// variable-length quantity\nfunction toVLQ(intNum) {\n    var v = intNum;\n    var r = [v & 0x7f];\n    while (true) {\n        v >>= 7;\n        if (v === 0) {\n            break;\n        }\n        r.unshift(0x80 + (v & 0x7f));\n    }\n    return r;\n}\n\nfunction serialize(e, includeDeltaTime) {\n    if (includeDeltaTime === void 0) { includeDeltaTime = true; }\n    var bytes = [];\n    function add(data) {\n        if (Array.isArray(data)) {\n            data.forEach(add);\n        }\n        else {\n            if (!Number.isInteger(data)) {\n                throw new Error(\"\\\"\".concat(data, \"\\\" is not integer\"));\n            }\n            bytes.push(data);\n        }\n    }\n    if (includeDeltaTime) {\n        add(toVLQ(e.deltaTime));\n    }\n    function addNumbers(list) {\n        add(list.length);\n        list.forEach(function (v) { return add(v); });\n    }\n    function addText(text) {\n        add(text.length);\n        add(toCharCodes(text));\n    }\n    switch (e.type) {\n        case \"meta\": {\n            var subtypeCode = MIDIMetaEvents[e.subtype];\n            if (subtypeCode === undefined) {\n                return [];\n            }\n            add(0xff); // type\n            add(subtypeCode); // subtype\n            switch (e.subtype) {\n                case \"sequenceNumber\":\n                    add(e.number);\n                    break;\n                case \"text\":\n                    addText(e.text);\n                    break;\n                case \"copyrightNotice\":\n                    addText(e.text);\n                    break;\n                case \"trackName\":\n                    addText(e.text);\n                    break;\n                case \"instrumentName\":\n                    addText(e.text);\n                    break;\n                case \"lyrics\":\n                    addText(e.text);\n                    break;\n                case \"marker\":\n                    addText(e.text);\n                    break;\n                case \"cuePoint\":\n                    addText(e.text);\n                    break;\n                case \"midiChannelPrefix\":\n                    addNumbers([e.value]);\n                    break;\n                case \"portPrefix\":\n                    addNumbers([e.port]);\n                    break;\n                case \"endOfTrack\":\n                    add(0);\n                    break;\n                case \"setTempo\": {\n                    var t = e.microsecondsPerBeat;\n                    addNumbers([(t >> 16) & 0xff, (t >> 8) & 0xff, t & 0xff]);\n                    break;\n                }\n                case \"smpteOffset\": {\n                    var frameRateByte = {\n                        24: 0x00,\n                        25: 0x20,\n                        29: 0x40,\n                        30: 0x60,\n                    };\n                    addNumbers([\n                        frameRateByte[e.frameRate] + (0x1f & e.hour),\n                        e.min,\n                        e.sec,\n                        e.frame,\n                        e.subframe,\n                    ]);\n                    break;\n                }\n                case \"timeSignature\": {\n                    addNumbers([\n                        e.numerator,\n                        Math.log2(e.denominator),\n                        e.metronome,\n                        e.thirtyseconds,\n                    ]);\n                    break;\n                }\n                case \"keySignature\": {\n                    addNumbers([e.key, e.scale]);\n                    break;\n                }\n                case \"sequencerSpecific\":\n                    addNumbers(e.data);\n                    break;\n                case \"unknown\":\n                    addNumbers(e.data);\n                    break;\n            }\n            break;\n        }\n        case \"sysEx\":\n            add(0xf0);\n            addNumbers(e.data);\n            break;\n        case \"dividedSysEx\":\n            add(0xf7);\n            addNumbers(e.data);\n            break;\n        case \"channel\": {\n            var subtypeCode = MIDIChannelEvents[e.subtype];\n            if (subtypeCode === undefined) {\n                return [];\n            }\n            add((subtypeCode << 4) + e.channel); // subtype + channel\n            switch (e.subtype) {\n                case \"noteOff\": {\n                    add(e.noteNumber);\n                    add(e.velocity);\n                    break;\n                }\n                case \"noteOn\": {\n                    add(e.noteNumber);\n                    add(e.velocity);\n                    break;\n                }\n                case \"noteAftertouch\": {\n                    add(e.noteNumber);\n                    add(e.amount);\n                    break;\n                }\n                case \"controller\": {\n                    add(e.controllerType);\n                    add(e.value);\n                    break;\n                }\n                case \"programChange\":\n                    add(e.value);\n                    break;\n                case \"channelAftertouch\":\n                    add(e.amount);\n                    break;\n                case \"pitchBend\": {\n                    add(e.value & 0x7f);\n                    add((e.value >> 7) & 0x7f);\n                    break;\n                }\n                case \"unknown\":\n                    add(e.data);\n                    break;\n            }\n            break;\n        }\n    }\n    return bytes;\n}\n\nvar Buffer = /** @class */ (function () {\n    function Buffer() {\n        this.data = [];\n        this.position = 0;\n    }\n    Object.defineProperty(Buffer.prototype, \"length\", {\n        get: function () {\n            return this.data.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Buffer.prototype.writeByte = function (v) {\n        this.data.push(v);\n        this.position++;\n    };\n    Buffer.prototype.writeStr = function (str) {\n        this.writeBytes(toCharCodes(str));\n    };\n    Buffer.prototype.writeInt32 = function (v) {\n        this.writeByte((v >> 24) & 0xff);\n        this.writeByte((v >> 16) & 0xff);\n        this.writeByte((v >> 8) & 0xff);\n        this.writeByte(v & 0xff);\n    };\n    Buffer.prototype.writeInt16 = function (v) {\n        this.writeByte((v >> 8) & 0xff);\n        this.writeByte(v & 0xff);\n    };\n    Buffer.prototype.writeBytes = function (arr) {\n        var _this = this;\n        arr.forEach(function (v) { return _this.writeByte(v); });\n    };\n    Buffer.prototype.writeChunk = function (id, func) {\n        this.writeStr(id);\n        var chunkBuf = new Buffer();\n        func(chunkBuf);\n        this.writeInt32(chunkBuf.length);\n        this.writeBytes(chunkBuf.data);\n    };\n    Buffer.prototype.toBytes = function () {\n        return new Uint8Array(this.data);\n    };\n    return Buffer;\n}());\n\n//https://sites.google.com/site/yyagisite/material/smfspec#format\nfunction write(tracks, ticksPerBeat) {\n    if (ticksPerBeat === void 0) { ticksPerBeat = 480; }\n    var buf = new Buffer();\n    // header chunk\n    buf.writeChunk(\"MThd\", function (it) {\n        it.writeInt16(1); // formatType\n        it.writeInt16(tracks.length); // trackCount\n        it.writeInt16(ticksPerBeat); // timeDivision\n    });\n    var _loop_1 = function (track) {\n        buf.writeChunk(\"MTrk\", function (it) {\n            for (var _i = 0, track_1 = track; _i < track_1.length; _i++) {\n                var event = track_1[_i];\n                it.writeBytes(serialize(event));\n            }\n        });\n    };\n    // track chunk\n    for (var _i = 0, tracks_1 = tracks; _i < tracks_1.length; _i++) {\n        var track = tracks_1[_i];\n        _loop_1(track);\n    }\n    return buf.toBytes();\n}\n\nexport { MIDIChannelEvents, MIDIControlEventNames, MIDIControlEvents, MIDIMetaEventNames, MIDIMetaEvents, Stream, deserialize, deserializeSingleEvent, read, serialize, write };\n//# sourceMappingURL=index.js.map\n","import { ControllerEvent, MIDIControlEvents } from \"midifile-ts\"\nimport { ImmediateEvent, MIDIEventBody } from \"../SynthEvent\"\nimport { DistributiveOmit } from \"../types\"\nimport { SynthProcessorCore } from \"./SynthProcessorCore\"\nimport { logger } from \"./logger\"\n\ntype RPNControllerEvent = DistributiveOmit<ControllerEvent, \"deltaTime\">\n\ninterface RPN {\n  rpnMSB?: RPNControllerEvent\n  rpnLSB?: RPNControllerEvent\n  dataMSB?: RPNControllerEvent\n  dataLSB?: RPNControllerEvent\n}\n\nexport class SynthEventHandler {\n  private rpnEvents: { [channel: number]: RPN | undefined } = {}\n  private bankSelectMSB: { [channel: number]: number | undefined } = {}\n\n  constructor(private readonly processor: SynthProcessorCore) {}\n\n  handleImmediateEvent(e: ImmediateEvent) {\n    switch (e.type) {\n      case \"sampleParameter\":\n        this.processor.addSampleParameter(e.parameter, e.range)\n        break\n      case \"loadSample\":\n        this.processor.addSample(e.data, e.sampleID)\n        break\n    }\n  }\n\n  handleDelayableEvent(e: MIDIEventBody) {\n    logger.log(\"handle delayable event\", e)\n\n    switch (e.type) {\n      case \"channel\": {\n        switch (e.subtype) {\n          case \"noteOn\":\n            this.processor.noteOn(e.channel, e.noteNumber, e.velocity)\n            break\n          case \"noteOff\":\n            this.processor.noteOff(e.channel, e.noteNumber)\n            break\n          case \"pitchBend\":\n            this.processor.pitchBend(e.channel, e.value)\n            break\n          case \"programChange\":\n            this.processor.programChange(e.channel, e.value)\n            break\n          case \"controller\": {\n            switch (e.controllerType) {\n              case MIDIControlEvents.NONREG_PARM_NUM_MSB:\n              case MIDIControlEvents.NONREG_PARM_NUM_LSB: // NRPN LSB\n                // Delete the rpn for do not send NRPN data events\n                delete this.rpnEvents[e.channel]\n                break\n              case MIDIControlEvents.REGIST_PARM_NUM_MSB: {\n                if (e.value === 127) {\n                  delete this.rpnEvents[e.channel]\n                } else {\n                  this.rpnEvents[e.channel] = {\n                    ...this.rpnEvents[e.channel],\n                    rpnMSB: e,\n                  }\n                }\n                break\n              }\n              case MIDIControlEvents.REGIST_PARM_NUM_LSB: {\n                if (e.value === 127) {\n                  delete this.rpnEvents[e.channel]\n                } else {\n                  this.rpnEvents[e.channel] = {\n                    ...this.rpnEvents[e.channel],\n                    rpnLSB: e,\n                  }\n                }\n                break\n              }\n              case MIDIControlEvents.MSB_DATA_ENTRY: {\n                const rpn = {\n                  ...this.rpnEvents[e.channel],\n                  dataMSB: e,\n                }\n                this.rpnEvents[e.channel] = rpn\n\n                // In case of pitch bend sensitivity,\n                // send without waiting for Data LSB event\n                if (rpn.rpnLSB?.value === 0) {\n                  this.processor.setPitchBendSensitivity(\n                    e.channel,\n                    rpn.dataMSB.value\n                  )\n                }\n                break\n              }\n              case MIDIControlEvents.LSB_DATA_ENTRY: {\n                this.rpnEvents[e.channel] = {\n                  ...this.rpnEvents[e.channel],\n                  dataLSB: e,\n                }\n                // TODO: Send other RPN events\n                break\n              }\n              case MIDIControlEvents.MSB_MAIN_VOLUME:\n                this.processor.setMainVolume(e.channel, e.value)\n                break\n              case MIDIControlEvents.MSB_EXPRESSION:\n                this.processor.expression(e.channel, e.value)\n                break\n              case MIDIControlEvents.ALL_SOUNDS_OFF:\n                this.processor.allSoundsOff(e.channel)\n                break\n              case MIDIControlEvents.ALL_NOTES_OFF:\n                this.processor.allNotesOff(e.channel)\n                break\n              case MIDIControlEvents.SUSTAIN:\n                this.processor.hold(e.channel, e.value)\n                break\n              case MIDIControlEvents.MSB_PAN:\n                this.processor.setPan(e.channel, e.value)\n                break\n              case MIDIControlEvents.MSB_MODWHEEL:\n                this.processor.modulation(e.channel, e.value)\n                break\n              case MIDIControlEvents.MSB_BANK:\n                this.bankSelectMSB[e.channel] = e.value\n                break\n              case MIDIControlEvents.LSB_BANK: {\n                const msb = this.bankSelectMSB[e.channel]\n                if (msb !== undefined) {\n                  const bank = (msb << 7) + e.value\n                  this.processor.bankSelect(e.channel, bank)\n                }\n                break\n              }\n              case MIDIControlEvents.RESET_CONTROLLERS:\n                this.processor.resetChannel(e.channel)\n                break\n            }\n            break\n          }\n        }\n        break\n      }\n    }\n  }\n}\n","// https://gist.github.com/fmal/763d9c953c5a5f8b8f9099dbc58da55e\nexport function insertSorted<T>(arr: T[], item: T, prop: keyof T) {\n  let low = 0\n  let high = arr.length\n  let mid\n  while (low < high) {\n    mid = (low + high) >>> 1 // like (num / 2) but faster\n    if (arr[mid][prop] < item[prop]) {\n      low = mid + 1\n    } else {\n      high = mid\n    }\n  }\n  arr.splice(low, 0, item)\n}\n","import {\n  ImmediateEvent,\n  MIDIEvent,\n  MIDIEventBody,\n  SynthEvent,\n} from \"../SynthEvent\"\nimport { insertSorted } from \"./insertSorted\"\nimport { logger } from \"./logger\"\n\ntype DelayedEvent = MIDIEvent & {\n  scheduledFrame: number\n  sequenceNumber: number\n}\n\nexport class SynthEventScheduler {\n  private scheduledEvents: DelayedEvent[] = []\n  private currentEvents: DelayedEvent[] = []\n\n  constructor(\n    private readonly getCurrentFrame: () => number,\n    private readonly onImmediateEvent: (e: ImmediateEvent) => void,\n    private readonly onDelayableEvent: (e: MIDIEventBody) => void\n  ) {}\n\n  private get currentFrame(): number {\n    return this.getCurrentFrame()\n  }\n\n  addEvent(e: SynthEvent & { sequenceNumber: number }) {\n    logger.log(e)\n\n    if (\"delayTime\" in e) {\n      // handle in process\n      insertSorted(\n        this.scheduledEvents,\n        {\n          ...e,\n          scheduledFrame: this.currentFrame + e.delayTime,\n        },\n        \"scheduledFrame\"\n      )\n    } else {\n      this.onImmediateEvent(e)\n    }\n  }\n\n  processScheduledEvents() {\n    if (this.scheduledEvents.length === 0) {\n      return\n    }\n\n    while (true) {\n      const e = this.scheduledEvents[0]\n      if (e === undefined || e.scheduledFrame > this.currentFrame) {\n        // scheduledEvents are sorted by scheduledFrame,\n        // so we can break early instead of iterating through all scheduledEvents,\n        break\n      }\n      this.scheduledEvents.shift()\n      this.currentEvents.push(e)\n    }\n\n    this.currentEvents.sort(sortEvents)\n\n    while (true) {\n      const e = this.currentEvents.shift()\n      if (e === undefined) {\n        break\n      }\n      this.onDelayableEvent(e.midi)\n    }\n  }\n\n  removeScheduledEvents(channel: number) {\n    this.scheduledEvents = this.scheduledEvents.filter(\n      (e) => e.midi.channel !== channel\n    )\n    this.currentEvents = this.currentEvents.filter(\n      (e) => e.midi.channel !== channel\n    )\n  }\n}\n\nfunction sortEvents<\n  T extends { scheduledFrame: number; sequenceNumber: number }\n>(a: T, b: T): number {\n  // First, compare by scheduledFrame.\n  if (a.scheduledFrame < b.scheduledFrame) {\n    return -1\n  } else if (a.scheduledFrame > b.scheduledFrame) {\n    return 1\n  }\n\n  // If scheduledFrame is the same, compare by sequenceNumber.\n  if (a.sequenceNumber < b.sequenceNumber) {\n    return -1\n  } else if (a.sequenceNumber > b.sequenceNumber) {\n    return 1\n  }\n\n  // If both fields are the same.\n  return 0\n}\n","export interface AmplitudeEnvelopeParameter {\n  attackTime: number\n  holdTime: number\n  decayTime: number\n  sustainLevel: number\n  releaseTime: number\n}\n\nenum EnvelopePhase {\n  attack,\n  hold,\n  decay,\n  sustain,\n  release,\n  forceStop,\n  stopped,\n}\n\nconst forceStopReleaseTime = 0.1\n\nexport class AmplitudeEnvelope {\n  private readonly parameter: AmplitudeEnvelopeParameter\n  private _phase = EnvelopePhase.stopped\n  private isNoteOff = false\n  private phaseTime = 0\n  private decayLevel = 0 // amplitude level at the end of decay phase\n  private lastAmplitude = 0\n  private readonly sampleRate: number\n\n  constructor(parameter: AmplitudeEnvelopeParameter, sampleRate: number) {\n    this.parameter = parameter\n    this.sampleRate = sampleRate\n  }\n\n  private get phase() {\n    return this._phase\n  }\n\n  private set phase(phase: EnvelopePhase) {\n    if (this._phase === phase) {\n      return\n    }\n    this._phase = phase\n    this.phaseTime = 0\n  }\n\n  noteOn() {\n    this.phase = EnvelopePhase.attack\n    this.isNoteOff = false\n    this.phaseTime = 0\n    this.decayLevel = this.parameter.sustainLevel\n  }\n\n  noteOff() {\n    this.isNoteOff = true\n  }\n\n  // Rapidly decrease the volume. This method ignores release time parameter\n  forceStop() {\n    this.phase = EnvelopePhase.forceStop\n  }\n\n  calculateAmplitude(bufferSize: number): number {\n    const { attackTime, holdTime, decayTime, sustainLevel, releaseTime } =\n      this.parameter\n    const { sampleRate } = this\n\n    if (\n      this.isNoteOff &&\n      (this.phase === EnvelopePhase.decay ||\n        this.phase === EnvelopePhase.sustain)\n    ) {\n      this.phase = EnvelopePhase.release\n      this.decayLevel = this.lastAmplitude\n    }\n\n    // Attack\n    switch (this.phase) {\n      case EnvelopePhase.attack: {\n        const amplificationPerFrame =\n          (1 / (attackTime * sampleRate)) * bufferSize\n        const value = this.lastAmplitude + amplificationPerFrame\n        if (value >= 1) {\n          this.phase = EnvelopePhase.hold\n          return 1\n        }\n        return value\n      }\n      case EnvelopePhase.hold: {\n        if (this.phaseTime >= holdTime) {\n          this.phase = EnvelopePhase.decay\n        }\n        return this.lastAmplitude\n      }\n      case EnvelopePhase.decay: {\n        const attenuationDecibel = linearToDecibel(sustainLevel / 1)\n        const value = logAttenuation(\n          1.0,\n          attenuationDecibel,\n          decayTime,\n          this.phaseTime\n        )\n        if (this.phaseTime > decayTime) {\n          if (sustainLevel <= 0) {\n            this.phase = EnvelopePhase.stopped\n            return 0\n          } else {\n            this.phase = EnvelopePhase.sustain\n            return sustainLevel\n          }\n        }\n        return value\n      }\n      case EnvelopePhase.sustain: {\n        return sustainLevel\n      }\n      case EnvelopePhase.release: {\n        const value = logAttenuation(\n          this.decayLevel,\n          -100, // -100dB means almost silence\n          releaseTime,\n          this.phaseTime\n        )\n        if (this.phaseTime > releaseTime || value <= 0) {\n          this.phase = EnvelopePhase.stopped\n          return 0\n        }\n        return value\n      }\n      case EnvelopePhase.forceStop: {\n        const attenuationPerFrame =\n          (1 / (forceStopReleaseTime * sampleRate)) * bufferSize\n        const value = this.lastAmplitude - attenuationPerFrame\n        if (value <= 0) {\n          this.phase = EnvelopePhase.stopped\n          return 0\n        }\n        return value\n      }\n      case EnvelopePhase.stopped: {\n        return 0\n      }\n    }\n  }\n\n  getAmplitude(bufferSize: number): number {\n    const value = this.calculateAmplitude(bufferSize)\n    this.lastAmplitude = value\n    this.phaseTime += bufferSize / sampleRate\n    return value\n  }\n\n  get isPlaying() {\n    return this.phase !== EnvelopePhase.stopped\n  }\n}\n\n// An exponential decay function. It attenuates the value of decibel over the duration time.\nfunction logAttenuation(\n  fromLevel: number,\n  attenuationDecibel: number,\n  duration: number,\n  time: number\n): number {\n  return fromLevel * decibelToLinear((attenuationDecibel / duration) * time)\n}\n\nfunction linearToDecibel(value: number): number {\n  return 20 * Math.log10(value)\n}\n\nfunction decibelToLinear(value: number): number {\n  return Math.pow(10, value / 20)\n}\n","export class LFO {\n  // Hz\n  frequency = 5\n  private phase = 0\n  private readonly sampleRate: number\n\n  constructor(sampleRate: number) {\n    this.sampleRate = sampleRate\n  }\n\n  getValue(bufferSize: number) {\n    const phase = this.phase\n    this.phase +=\n      ((Math.PI * 2 * this.frequency) / this.sampleRate) * bufferSize\n    return Math.sin(phase)\n  }\n}\n","import { AmplitudeEnvelope } from \"./AmplitudeEnvelope\"\nimport { LFO } from \"./LFO\"\nimport { Sample } from \"./SampleTable\"\n\nexport class WavetableOscillator {\n  readonly sample: Sample\n  private sampleIndex = 0\n  private _isPlaying = false\n  private _isNoteOff = false\n  private baseSpeed = 1\n  private readonly envelope: AmplitudeEnvelope\n  private readonly pitchLFO: LFO\n  private readonly sampleRate: number\n\n  speed = 1\n  // 0 to 1\n  private velocity = 1\n  // 0 to 1\n  volume = 1\n\n  modulation = 0\n\n  // cent\n  modulationDepthRange = 50\n\n  // -1 to 1\n  pan = 0\n\n  // This oscillator should be note off when hold pedal off\n  isHold = false\n\n  constructor(sample: Sample, sampleRate: number) {\n    this.sample = sample\n    this.sampleRate = sampleRate\n    this.envelope = new AmplitudeEnvelope(sample.amplitudeEnvelope, sampleRate)\n    this.pitchLFO = new LFO(sampleRate)\n  }\n\n  noteOn(pitch: number, velocity: number) {\n    this.velocity = velocity\n    this._isPlaying = true\n    this.sampleIndex = this.sample.sampleStart\n    this.baseSpeed = Math.pow(\n      2,\n      ((pitch - this.sample.pitch) / 12) * this.sample.scaleTuning\n    )\n    this.pitchLFO.frequency = 5\n    this.envelope.noteOn()\n  }\n\n  noteOff() {\n    this.envelope.noteOff()\n    this._isNoteOff = true\n  }\n\n  forceStop() {\n    this.envelope.forceStop()\n  }\n\n  process(outputs: Float32Array[]) {\n    if (!this._isPlaying) {\n      return\n    }\n\n    const speed =\n      (this.baseSpeed * this.speed * this.sample.sampleRate) / this.sampleRate\n    const volume = (this.velocity * this.volume) ** 2 * this.sample.volume\n\n    // zero to pi/2\n    const panTheta =\n      ((Math.min(1, Math.max(-1, this.pan + this.sample.pan)) + 1) * Math.PI) /\n      4\n    const leftPanVolume = Math.cos(panTheta)\n    const rightPanVolume = Math.sin(panTheta)\n    const gain = this.envelope.getAmplitude(outputs[0].length)\n    const leftGain = gain * volume * leftPanVolume\n    const rightGain = gain * volume * rightPanVolume\n\n    const pitchLFOValue = this.pitchLFO.getValue(outputs[0].length)\n    const pitchModulation =\n      pitchLFOValue * this.modulation * (this.modulationDepthRange / 1200)\n    const modulatedSpeed = speed * (1 + pitchModulation)\n\n    for (let i = 0; i < outputs[0].length; ++i) {\n      const index = Math.floor(this.sampleIndex)\n      const advancedIndex = this.sampleIndex + modulatedSpeed\n      let loopIndex: number | null = null\n\n      if (\n        (this.sample.loop.type === \"loop_continuous\" ||\n          (this.sample.loop.type === \"loop_sustain\" && !this._isNoteOff)) &&\n        advancedIndex >= this.sample.loop.end\n      ) {\n        loopIndex =\n          this.sample.loop.start + (advancedIndex - Math.floor(advancedIndex))\n      }\n\n      const nextIndex =\n        loopIndex !== null\n          ? Math.floor(loopIndex)\n          : Math.min(index + 1, this.sample.sampleEnd - 1)\n\n      // linear interpolation\n      const current = this.sample.buffer[index]\n      const next = this.sample.buffer[nextIndex]\n      const level = current + (next - current) * (this.sampleIndex - index)\n\n      outputs[0][i] += level * leftGain\n      outputs[1][i] += level * rightGain\n\n      this.sampleIndex = loopIndex ?? advancedIndex\n\n      if (this.sampleIndex >= this.sample.sampleEnd) {\n        this._isPlaying = false\n        break\n      }\n    }\n  }\n\n  get isPlaying() {\n    return this._isPlaying && this.envelope.isPlaying\n  }\n\n  get isNoteOff() {\n    return this._isNoteOff\n  }\n\n  get exclusiveClass() {\n    return this.sample.exclusiveClass\n  }\n}\n","import { SampleParameter, SampleRange, SynthEvent } from \"../SynthEvent\"\nimport { logger } from \"./logger\"\nimport { Sample, SampleTable } from \"./SampleTable\"\nimport { SynthEventHandler } from \"./SynthEventHandler\"\nimport { SynthEventScheduler } from \"./SynthEventScheduler\"\nimport { WavetableOscillator } from \"./WavetableOscillator\"\n\ninterface ChannelState {\n  volume: number // 0 to 1\n  bank: number\n  instrument: number\n  pitchBend: number // in semitone\n  pitchBendSensitivity: number // in semitone\n  expression: number // 0 to 1\n  pan: number // -1 to 1\n  modulation: number\n  oscillators: { [key: number]: WavetableOscillator[] }\n  hold: boolean\n}\n\nconst initialChannelState = (): ChannelState => ({\n  volume: 1,\n  bank: 0,\n  instrument: 0,\n  pitchBend: 0,\n  pitchBendSensitivity: 2,\n  oscillators: {},\n  expression: 1,\n  pan: 0,\n  modulation: 0,\n  hold: false,\n})\n\nconst RHYTHM_CHANNEL = 9\nconst RHYTHM_BANK = 128\n\nexport class SynthProcessorCore {\n  private sampleTable = new SampleTable()\n  private channels: { [key: number]: ChannelState } = {}\n  private readonly eventScheduler: SynthEventScheduler\n\n  constructor(\n    private readonly sampleRate: number,\n    private readonly getCurrentFrame: () => number\n  ) {\n    const eventHandler = new SynthEventHandler(this)\n    this.eventScheduler = new SynthEventScheduler(\n      getCurrentFrame,\n      (e) => eventHandler.handleImmediateEvent(e),\n      (e) => eventHandler.handleDelayableEvent(e)\n    )\n    this.sampleRate = sampleRate\n    this.getCurrentFrame = getCurrentFrame\n  }\n\n  get currentFrame(): number {\n    return this.getCurrentFrame()\n  }\n\n  private getSamples(\n    channel: number,\n    pitch: number,\n    velocity: number\n  ): Sample[] {\n    const state = this.getChannelState(channel)\n    // Play drums for CH.10\n    const bank = channel === RHYTHM_CHANNEL ? RHYTHM_BANK : state.bank\n    return this.sampleTable.getSamples(bank, state.instrument, pitch, velocity)\n  }\n\n  addSample(data: ArrayBuffer, sampleID: number) {\n    this.sampleTable.addSample(new Float32Array(data), sampleID)\n  }\n\n  addSampleParameter(parameter: SampleParameter, range: SampleRange) {\n    this.sampleTable.addSampleParameter(parameter, range)\n  }\n\n  addEvent(e: SynthEvent & { sequenceNumber: number }) {\n    this.eventScheduler.addEvent(e)\n  }\n\n  noteOn(channel: number, pitch: number, velocity: number) {\n    const state = this.getChannelState(channel)\n\n    const samples = this.getSamples(channel, pitch, velocity)\n\n    if (samples.length === 0) {\n      logger.warn(\n        `There is no sample for noteNumber ${pitch} in instrument ${state.instrument} in bank ${state.bank}`\n      )\n      return\n    }\n\n    for (const sample of samples) {\n      const oscillator = new WavetableOscillator(sample, this.sampleRate)\n\n      const volume = velocity / 127\n      oscillator.noteOn(pitch, volume)\n\n      if (state.oscillators[pitch] === undefined) {\n        state.oscillators[pitch] = []\n      }\n\n      if (sample.exclusiveClass !== undefined) {\n        for (const key in state.oscillators) {\n          for (const osc of state.oscillators[key]) {\n            if (osc.exclusiveClass === sample.exclusiveClass) {\n              osc.forceStop()\n            }\n          }\n        }\n      }\n\n      state.oscillators[pitch].push(oscillator)\n    }\n  }\n\n  noteOff(channel: number, pitch: number) {\n    const state = this.getChannelState(channel)\n\n    if (state.oscillators[pitch] === undefined) {\n      return\n    }\n\n    for (const osc of state.oscillators[pitch]) {\n      if (!osc.isNoteOff) {\n        if (state.hold) {\n          osc.isHold = true\n        } else {\n          osc.noteOff()\n        }\n      }\n    }\n  }\n\n  pitchBend(channel: number, value: number) {\n    const state = this.getChannelState(channel)\n    state.pitchBend = (value / 0x2000 - 1) * state.pitchBendSensitivity\n  }\n\n  programChange(channel: number, value: number) {\n    const state = this.getChannelState(channel)\n    state.instrument = value\n  }\n\n  setPitchBendSensitivity(channel: number, value: number) {\n    const state = this.getChannelState(channel)\n    state.pitchBendSensitivity = value\n  }\n\n  setMainVolume(channel: number, value: number) {\n    const state = this.getChannelState(channel)\n    state.volume = value / 127\n  }\n\n  expression(channel: number, value: number) {\n    const state = this.getChannelState(channel)\n    state.expression = value / 127\n  }\n\n  allSoundsOff(channel: number) {\n    this.eventScheduler.removeScheduledEvents(channel)\n    const state = this.getChannelState(channel)\n\n    for (const key in state.oscillators) {\n      for (const osc of state.oscillators[key]) {\n        osc.forceStop()\n      }\n    }\n  }\n\n  allNotesOff(channel: number) {\n    const state = this.getChannelState(channel)\n\n    for (const key in state.oscillators) {\n      for (const osc of state.oscillators[key]) {\n        osc.noteOff()\n      }\n    }\n  }\n\n  hold(channel: number, value: number) {\n    const hold = value >= 64\n    const state = this.getChannelState(channel)\n    state.hold = hold\n\n    if (hold) {\n      return\n    }\n\n    for (const key in state.oscillators) {\n      for (const osc of state.oscillators[key]) {\n        if (osc.isHold) {\n          osc.noteOff()\n        }\n      }\n    }\n  }\n\n  setPan(channel: number, value: number) {\n    const state = this.getChannelState(channel)\n    state.pan = (value / 127 - 0.5) * 2\n  }\n\n  bankSelect(channel: number, value: number) {\n    const state = this.getChannelState(channel)\n    state.bank = value\n  }\n\n  modulation(channel: number, value: number) {\n    const state = this.getChannelState(channel)\n    state.modulation = value / 127\n  }\n\n  resetChannel(channel: number) {\n    delete this.channels[channel]\n  }\n\n  private getChannelState(channel: number): ChannelState {\n    const state = this.channels[channel]\n    if (state !== undefined) {\n      return state\n    }\n    const newState = initialChannelState()\n    this.channels[channel] = newState\n    return newState\n  }\n\n  process(outputs: Float32Array[]): void {\n    this.eventScheduler.processScheduledEvents()\n\n    for (const channel in this.channels) {\n      const state = this.channels[channel]\n\n      for (let key in state.oscillators) {\n        state.oscillators[key] = state.oscillators[key].filter((oscillator) => {\n          oscillator.speed = Math.pow(2, state.pitchBend / 12)\n          oscillator.volume = state.volume * state.expression\n          oscillator.pan = state.pan\n          oscillator.modulation = state.modulation\n          oscillator.process([outputs[0], outputs[1]])\n\n          if (!oscillator.isPlaying) {\n            return false\n          }\n          return true\n        })\n      }\n    }\n  }\n}\n","import {\n  AudioData,\n  LoadSampleEvent,\n  SampleParameterEvent,\n  SynthEvent,\n} from \"..\"\nimport { max } from \"../helper/math\"\nimport { SynthProcessorCore } from \"../processor/SynthProcessorCore\"\n\n// returns in frame unit\nconst getSongLength = (events: SynthEvent[]) =>\n  max(events.map((e) => (e.type === \"midi\" ? e.delayTime : 0))) ?? 0\n\n// Maximum time to wait for the note release sound to become silent\nconst silentTimeoutSec = 5\n\nexport interface RenderAudioOptions {\n  sampleRate?: number\n  onProgress?: (numFrames: number, totalFrames: number) => void\n  cancel?: () => boolean\n  bufferSize?: number\n  waitForEventLoop?: () => Promise<void>\n}\n\nconst isArrayZero = <T>(arr: ArrayLike<T>) => {\n  for (let i = 0; i < arr.length; i++) {\n    if (arr[i] !== 0) {\n      return false\n    }\n  }\n  return true\n}\n\nexport const renderAudio = async (\n  samples: (LoadSampleEvent | SampleParameterEvent)[],\n  events: SynthEvent[],\n  options?: RenderAudioOptions\n): Promise<AudioData> => {\n  let currentFrame = 0\n  const sampleRate = options?.sampleRate ?? 44100\n  const bufSize = options?.bufferSize ?? 500\n\n  const synth = new SynthProcessorCore(sampleRate, () => currentFrame)\n\n  let sequenceNumber = 0\n  samples.forEach((e) =>\n    synth.addEvent({ ...e, sequenceNumber: sequenceNumber++ })\n  )\n  events.forEach((e) =>\n    synth.addEvent({ ...e, sequenceNumber: sequenceNumber++ })\n  )\n\n  const songLengthFrame = getSongLength(events)\n  const iterCount = Math.ceil(songLengthFrame / bufSize)\n  const additionalIterCount = Math.ceil(\n    (silentTimeoutSec * sampleRate) / bufSize\n  )\n  const allIterCount = iterCount + additionalIterCount\n  const audioBufferSize = allIterCount * bufSize\n\n  const leftData = new Float32Array(audioBufferSize)\n  const rightData = new Float32Array(audioBufferSize)\n\n  const buffer = [new Float32Array(bufSize), new Float32Array(bufSize)]\n\n  for (let i = 0; i < allIterCount; i++) {\n    buffer[0].fill(0)\n    buffer[1].fill(0)\n    synth.process(buffer)\n    const offset = i * bufSize\n    leftData.set(buffer[0], offset)\n    rightData.set(buffer[1], offset)\n    currentFrame += bufSize\n\n    // Wait for silence after playback is complete.\n    if (i > iterCount && isArrayZero(buffer[0]) && isArrayZero(buffer[1])) {\n      console.log(`early break ${i} in ${iterCount + additionalIterCount}`)\n      break\n    }\n\n    // give a chance to terminate the loop or update progress\n    if (i % 1000 === 0) {\n      await options?.waitForEventLoop?.()\n\n      options?.onProgress?.(offset, audioBufferSize)\n\n      if (options?.cancel?.()) {\n        throw new Error(\"renderAudio cancelled\")\n      }\n    }\n  }\n\n  // slice() to delete silent parts\n  const trimmedLeft = leftData.slice(0, currentFrame)\n  const trimmedRight = rightData.slice(0, currentFrame)\n\n  return {\n    length: trimmedLeft.length,\n    leftData: trimmedLeft.buffer,\n    rightData: trimmedRight.buffer,\n    sampleRate,\n  }\n}\n","class Stream {\n    constructor(data, offset) {\n        this.data = data;\n        this.ip = offset;\n    }\n    readString(size) {\n        const str = String.fromCharCode.apply(null, this.data.subarray(this.ip, (this.ip += size)));\n        const nullLocation = str.indexOf(\"\\u0000\");\n        if (nullLocation > 0) {\n            return str.substr(0, nullLocation);\n        }\n        return str;\n    }\n    readWORD() {\n        return this.data[this.ip++] | (this.data[this.ip++] << 8);\n    }\n    readDWORD(bigEndian = false) {\n        if (bigEndian) {\n            return (((this.data[this.ip++] << 24) |\n                (this.data[this.ip++] << 16) |\n                (this.data[this.ip++] << 8) |\n                this.data[this.ip++]) >>>\n                0);\n        }\n        else {\n            return ((this.data[this.ip++] |\n                (this.data[this.ip++] << 8) |\n                (this.data[this.ip++] << 16) |\n                (this.data[this.ip++] << 24)) >>>\n                0);\n        }\n    }\n    readByte() {\n        return this.data[this.ip++];\n    }\n    readAt(offset) {\n        return this.data[this.ip + offset];\n    }\n    /* helper */\n    readUInt8() {\n        return this.readByte();\n    }\n    readInt8() {\n        return (this.readByte() << 24) >> 24;\n    }\n    readUInt16() {\n        return this.readWORD();\n    }\n    readInt16() {\n        return (this.readWORD() << 16) >> 16;\n    }\n    readUInt32() {\n        return this.readDWORD();\n    }\n}\n\nfunction parseChunk$1(input, ip, bigEndian) {\n    const stream = new Stream(input, ip);\n    const type = stream.readString(4);\n    const size = stream.readDWORD(bigEndian);\n    return new Chunk(type, size, stream.ip);\n}\nfunction parseRiff(input, index = 0, length, { padding = true, bigEndian = false } = {}) {\n    const chunkList = [];\n    const end = length + index;\n    let ip = index;\n    while (ip < end) {\n        const chunk = parseChunk$1(input, ip, bigEndian);\n        ip = chunk.offset + chunk.size;\n        // padding\n        if (padding && ((ip - index) & 1) === 1) {\n            ip++;\n        }\n        chunkList.push(chunk);\n    }\n    return chunkList;\n}\nclass Chunk {\n    constructor(type, size, offset) {\n        this.type = type;\n        this.size = size;\n        this.offset = offset;\n    }\n}\n\nconst GeneratorEnumeratorTable = [\n    \"startAddrsOffset\",\n    \"endAddrsOffset\",\n    \"startloopAddrsOffset\",\n    \"endloopAddrsOffset\",\n    \"startAddrsCoarseOffset\",\n    \"modLfoToPitch\",\n    \"vibLfoToPitch\",\n    \"modEnvToPitch\",\n    \"initialFilterFc\",\n    \"initialFilterQ\",\n    \"modLfoToFilterFc\",\n    \"modEnvToFilterFc\",\n    \"endAddrsCoarseOffset\",\n    \"modLfoToVolume\",\n    undefined, // 14\n    \"chorusEffectsSend\",\n    \"reverbEffectsSend\",\n    \"pan\",\n    undefined,\n    undefined,\n    undefined, // 18,19,20\n    \"delayModLFO\",\n    \"freqModLFO\",\n    \"delayVibLFO\",\n    \"freqVibLFO\",\n    \"delayModEnv\",\n    \"attackModEnv\",\n    \"holdModEnv\",\n    \"decayModEnv\",\n    \"sustainModEnv\",\n    \"releaseModEnv\",\n    \"keynumToModEnvHold\",\n    \"keynumToModEnvDecay\",\n    \"delayVolEnv\",\n    \"attackVolEnv\",\n    \"holdVolEnv\",\n    \"decayVolEnv\",\n    \"sustainVolEnv\",\n    \"releaseVolEnv\",\n    \"keynumToVolEnvHold\",\n    \"keynumToVolEnvDecay\",\n    \"instrument\",\n    undefined, // 42\n    \"keyRange\",\n    \"velRange\",\n    \"startloopAddrsCoarseOffset\",\n    \"keynum\",\n    \"velocity\",\n    \"initialAttenuation\",\n    undefined, // 49\n    \"endloopAddrsCoarseOffset\",\n    \"coarseTune\",\n    \"fineTune\",\n    \"sampleID\",\n    \"sampleModes\",\n    undefined, // 55\n    \"scaleTuning\",\n    \"exclusiveClass\",\n    \"overridingRootKey\",\n];\n\nclass VersionTag {\n    static parse(stream) {\n        const v = new VersionTag();\n        v.major = stream.readInt8();\n        v.minor = stream.readInt8();\n        return v;\n    }\n}\nclass Info {\n    // LIST - INFO  chunk\n    static parse(data, chunks) {\n        function getChunk(type) {\n            return chunks.find((c) => c.type === type);\n        }\n        function toStream(chunk) {\n            return new Stream(data, chunk.offset);\n        }\n        function readString(type) {\n            const chunk = getChunk(type);\n            if (!chunk) {\n                return null;\n            }\n            return toStream(chunk).readString(chunk.size);\n        }\n        function readVersionTag(type) {\n            const chunk = getChunk(type);\n            if (!chunk) {\n                return null;\n            }\n            return VersionTag.parse(toStream(chunk));\n        }\n        const info = new Info();\n        info.comment = readString(\"ICMT\");\n        info.copyright = readString(\"ICOP\");\n        info.creationDate = readString(\"ICRD\");\n        info.engineer = readString(\"IENG\");\n        info.name = readString(\"INAM\");\n        info.product = readString(\"IPRD\");\n        info.software = readString(\"ISFT\");\n        info.version = readVersionTag(\"ifil\");\n        info.soundEngine = readString(\"isng\");\n        info.romName = readString(\"irom\");\n        info.romVersion = readVersionTag(\"iver\");\n        return info;\n    }\n}\nclass PresetHeader {\n    get isEnd() {\n        return this.presetName === \"EOP\";\n    }\n    static parse(stream) {\n        const p = new PresetHeader();\n        p.presetName = stream.readString(20);\n        p.preset = stream.readWORD();\n        p.bank = stream.readWORD();\n        p.presetBagIndex = stream.readWORD();\n        p.library = stream.readDWORD();\n        p.genre = stream.readDWORD();\n        p.morphology = stream.readDWORD();\n        return p;\n    }\n}\nclass PresetBag {\n    static parse(stream) {\n        const p = new PresetBag();\n        p.presetGeneratorIndex = stream.readWORD();\n        p.presetModulatorIndex = stream.readWORD();\n        return p;\n    }\n}\nclass RangeValue {\n    constructor(lo, hi) {\n        this.lo = lo;\n        this.hi = hi;\n    }\n    static parse(stream) {\n        return new RangeValue(stream.readByte(), stream.readByte());\n    }\n}\nclass ModulatorList {\n    get type() {\n        return GeneratorEnumeratorTable[this.destinationOper];\n    }\n    get isEnd() {\n        return (this.sourceOper === 0 &&\n            this.destinationOper === 0 &&\n            this.value === 0 &&\n            this.amountSourceOper === 0 &&\n            this.transOper === 0);\n    }\n    static parse(stream) {\n        const t = new ModulatorList();\n        t.sourceOper = stream.readWORD();\n        t.destinationOper = stream.readWORD();\n        switch (t.type) {\n            case \"keyRange\": /* FALLTHROUGH */\n            case \"velRange\": /* FALLTHROUGH */\n            case \"keynum\": /* FALLTHROUGH */\n            case \"velocity\":\n                t.value = RangeValue.parse(stream);\n                break;\n            default:\n                t.value = stream.readInt16();\n                break;\n        }\n        t.amountSourceOper = stream.readWORD();\n        t.transOper = stream.readWORD();\n        return t;\n    }\n}\nclass GeneratorList {\n    get type() {\n        return GeneratorEnumeratorTable[this.code];\n    }\n    get isEnd() {\n        return this.code === 0 && this.value === 0;\n    }\n    static parse(stream) {\n        const t = new GeneratorList();\n        t.code = stream.readWORD();\n        switch (t.type) {\n            case \"keynum\": /* FALLTHROUGH */\n            case \"keyRange\": /* FALLTHROUGH */\n            case \"velRange\": /* FALLTHROUGH */\n            case \"velocity\":\n                t.value = RangeValue.parse(stream);\n                break;\n            default:\n                t.value = stream.readInt16();\n                break;\n        }\n        return t;\n    }\n}\nclass Instrument {\n    get isEnd() {\n        return this.instrumentName === \"EOI\";\n    }\n    static parse(stream) {\n        const t = new Instrument();\n        t.instrumentName = stream.readString(20);\n        t.instrumentBagIndex = stream.readWORD();\n        return t;\n    }\n}\nclass InstrumentBag {\n    static parse(stream) {\n        const t = new InstrumentBag();\n        t.instrumentGeneratorIndex = stream.readWORD();\n        t.instrumentModulatorIndex = stream.readWORD();\n        return t;\n    }\n}\nclass SampleHeader {\n    get isEnd() {\n        return this.sampleName === \"EOS\";\n    }\n    static parse(stream) {\n        const s = new SampleHeader();\n        s.sampleName = stream.readString(20);\n        s.start = stream.readDWORD();\n        s.end = stream.readDWORD();\n        s.loopStart = stream.readDWORD();\n        s.loopEnd = stream.readDWORD();\n        s.sampleRate = stream.readDWORD();\n        s.originalPitch = stream.readByte();\n        s.pitchCorrection = stream.readInt8();\n        s.sampleLink = stream.readWORD();\n        s.sampleType = stream.readWORD();\n        s.loopStart -= s.start;\n        s.loopEnd -= s.start;\n        return s;\n    }\n}\n\nfunction parse(input, option = {}) {\n    // parse RIFF chunk\n    const chunkList = parseRiff(input, 0, input.length, option);\n    if (chunkList.length !== 1) {\n        throw new Error(\"wrong chunk length\");\n    }\n    const chunk = chunkList[0];\n    if (chunk === null) {\n        throw new Error(\"chunk not found\");\n    }\n    function parseRiffChunk(chunk, data) {\n        const chunkList = getChunkList(chunk, data, \"RIFF\", \"sfbk\");\n        if (chunkList.length !== 3) {\n            throw new Error(\"invalid sfbk structure\");\n        }\n        return Object.assign({ \n            // INFO-list\n            info: parseInfoList(chunkList[0], data), \n            // sdta-list\n            samplingData: parseSdtaList(chunkList[1], data) }, parsePdtaList(chunkList[2], data));\n    }\n    function parsePdtaList(chunk, data) {\n        const chunkList = getChunkList(chunk, data, \"LIST\", \"pdta\");\n        // check number of chunks\n        if (chunkList.length !== 9) {\n            throw new Error(\"invalid pdta chunk\");\n        }\n        return {\n            presetHeaders: parsePhdr(chunkList[0], data),\n            presetZone: parsePbag(chunkList[1], data),\n            presetModulators: parsePmod(chunkList[2], data),\n            presetGenerators: parsePgen(chunkList[3], data),\n            instruments: parseInst(chunkList[4], data),\n            instrumentZone: parseIbag(chunkList[5], data),\n            instrumentModulators: parseImod(chunkList[6], data),\n            instrumentGenerators: parseIgen(chunkList[7], data),\n            sampleHeaders: parseShdr(chunkList[8], data),\n        };\n    }\n    const result = parseRiffChunk(chunk, input);\n    return Object.assign(Object.assign({}, result), { samples: loadSample(result.sampleHeaders, result.samplingData.offsetMSB, result.samplingData.offsetLSB, input) });\n}\nfunction getChunkList(chunk, data, expectedType, expectedSignature) {\n    // check parse target\n    if (chunk.type !== expectedType) {\n        throw new Error(\"invalid chunk type:\" + chunk.type);\n    }\n    const stream = new Stream(data, chunk.offset);\n    // check signature\n    const signature = stream.readString(4);\n    if (signature !== expectedSignature) {\n        throw new Error(\"invalid signature:\" + signature);\n    }\n    // read structure\n    return parseRiff(data, stream.ip, chunk.size - 4);\n}\nfunction parseInfoList(chunk, data) {\n    const chunkList = getChunkList(chunk, data, \"LIST\", \"INFO\");\n    return Info.parse(data, chunkList);\n}\nfunction parseSdtaList(chunk, data) {\n    var _a;\n    const chunkList = getChunkList(chunk, data, \"LIST\", \"sdta\");\n    return {\n        offsetMSB: chunkList[0].offset,\n        offsetLSB: (_a = chunkList[1]) === null || _a === void 0 ? void 0 : _a.offset,\n    };\n}\nfunction parseChunk(chunk, data, type, clazz, terminate) {\n    const result = [];\n    if (chunk.type !== type) {\n        throw new Error(\"invalid chunk type:\" + chunk.type);\n    }\n    const stream = new Stream(data, chunk.offset);\n    const size = chunk.offset + chunk.size;\n    while (stream.ip < size) {\n        const obj = clazz.parse(stream);\n        if (terminate && terminate(obj)) {\n            break;\n        }\n        result.push(obj);\n    }\n    return result;\n}\nconst parsePhdr = (chunk, data) => parseChunk(chunk, data, \"phdr\", PresetHeader, (p) => p.isEnd);\nconst parsePbag = (chunk, data) => parseChunk(chunk, data, \"pbag\", PresetBag);\nconst parseInst = (chunk, data) => parseChunk(chunk, data, \"inst\", Instrument, (i) => i.isEnd);\nconst parseIbag = (chunk, data) => parseChunk(chunk, data, \"ibag\", InstrumentBag);\nconst parsePmod = (chunk, data) => parseChunk(chunk, data, \"pmod\", ModulatorList, (m) => m.isEnd);\nconst parseImod = (chunk, data) => parseChunk(chunk, data, \"imod\", ModulatorList, (m) => m.isEnd);\nconst parsePgen = (chunk, data) => parseChunk(chunk, data, \"pgen\", GeneratorList, (g) => g.isEnd);\nconst parseIgen = (chunk, data) => parseChunk(chunk, data, \"igen\", GeneratorList);\nconst parseShdr = (chunk, data) => parseChunk(chunk, data, \"shdr\", SampleHeader, (s) => s.isEnd);\nfunction adjustSampleData(sample, sampleRate) {\n    let multiply = 1;\n    // buffer\n    while (sampleRate < 22050) {\n        const newSample = new Int16Array(sample.length * 2);\n        for (let i = 0, j = 0, il = sample.length; i < il; ++i) {\n            newSample[j++] = sample[i];\n            newSample[j++] = sample[i];\n        }\n        sample = newSample;\n        multiply *= 2;\n        sampleRate *= 2;\n    }\n    return {\n        sample,\n        multiply,\n    };\n}\nfunction loadSample(sampleHeader, samplingDataOffsetMSB, samplingDataOffsetLSB, data) {\n    return sampleHeader.map((header) => {\n        let sample = new Int16Array(new Uint8Array(data.subarray(samplingDataOffsetMSB + header.start * 2, samplingDataOffsetMSB + header.end * 2)).buffer);\n        // TODO: support 24bit sample\n        if (header.sampleRate > 0) {\n            const adjust = adjustSampleData(sample, header.sampleRate);\n            sample = adjust.sample;\n            header.sampleRate *= adjust.multiply;\n            header.loopStart *= adjust.multiply;\n            header.loopEnd *= adjust.multiply;\n        }\n        return sample;\n    });\n}\n\nfunction createGeneraterObject(generators) {\n    const result = {};\n    for (const gen of generators) {\n        const type = gen.type;\n        if (type !== undefined) {\n            result[type] = gen.value;\n        }\n    }\n    return result;\n}\nconst defaultInstrumentZone = {\n    keynum: undefined,\n    instrument: undefined,\n    velocity: undefined,\n    exclusiveClass: undefined,\n    keyRange: new RangeValue(0, 127),\n    velRange: new RangeValue(0, 127),\n    sampleID: undefined,\n    delayVolEnv: -12000,\n    attackVolEnv: -12000,\n    decayVolEnv: -12000,\n    holdVolEnv: -12000,\n    sustainVolEnv: 0,\n    releaseVolEnv: -12000,\n    delayModEnv: -12000,\n    attackModEnv: -12000,\n    decayModEnv: -12000,\n    holdModEnv: -12000,\n    sustainModEnv: 0,\n    releaseModEnv: -12000,\n    modEnvToPitch: 0,\n    modEnvToFilterFc: 0,\n    modLfoToFilterFc: 0,\n    modLfoToPitch: 0,\n    modLfoToVolume: 0,\n    vibLfoToPitch: 0,\n    chorusEffectsSend: 0,\n    reverbEffectsSend: 0,\n    delayModLFO: 0,\n    freqModLFO: 0,\n    delayVibLFO: 0,\n    keynumToModEnvDecay: 0,\n    keynumToModEnvHold: 0,\n    keynumToVolEnvDecay: 0,\n    keynumToVolEnvHold: 0,\n    coarseTune: 0,\n    fineTune: 0,\n    scaleTuning: 100,\n    freqVibLFO: 0,\n    startAddrsOffset: 0,\n    startAddrsCoarseOffset: 0,\n    endAddrsOffset: 0,\n    endAddrsCoarseOffset: 0,\n    startloopAddrsOffset: 0,\n    startloopAddrsCoarseOffset: 0,\n    initialAttenuation: 0,\n    endloopAddrsOffset: 0,\n    endloopAddrsCoarseOffset: 0,\n    overridingRootKey: undefined,\n    initialFilterQ: 1,\n    initialFilterFc: 13500,\n    sampleModes: 0,\n    pan: undefined,\n};\n\nfunction arrayRange(start, end) {\n    return Array.from({ length: end - start }, (_, k) => k + start);\n}\nfunction getInstrumentZone(parsed, instrumentZoneIndex) {\n    const instrumentBag = parsed.instrumentZone[instrumentZoneIndex];\n    const nextInstrumentBag = parsed.instrumentZone[instrumentZoneIndex + 1];\n    const generatorIndex = instrumentBag.instrumentGeneratorIndex;\n    const nextGeneratorIndex = nextInstrumentBag\n        ? nextInstrumentBag.instrumentGeneratorIndex\n        : parsed.instrumentGenerators.length;\n    return parsed.instrumentGenerators.slice(generatorIndex, nextGeneratorIndex);\n}\nfunction getInstrumentZoneIndexes(parsed, instrumentID) {\n    const instrument = parsed.instruments[instrumentID];\n    const nextInstrument = parsed.instruments[instrumentID + 1];\n    return arrayRange(instrument.instrumentBagIndex, nextInstrument\n        ? nextInstrument.instrumentBagIndex\n        : parsed.instrumentZone.length);\n}\nfunction getInstrumentGenerators(parsed, instrumentID) {\n    return getInstrumentZoneIndexes(parsed, instrumentID).map((i) => getInstrumentZone(parsed, i));\n}\n\nfunction getPresetGenerators(parsed, presetHeaderIndex) {\n    let presetGenerators;\n    const presetHeader = parsed.presetHeaders[presetHeaderIndex];\n    const presetBag = parsed.presetZone[presetHeader.presetBagIndex];\n    const nextPresetHeaderIndex = presetHeaderIndex + 1;\n    if (nextPresetHeaderIndex < parsed.presetHeaders.length) {\n        //  preset  generator \n        const nextPresetHeader = parsed.presetHeaders[nextPresetHeaderIndex];\n        const nextPresetBag = parsed.presetZone[nextPresetHeader.presetBagIndex];\n        presetGenerators = parsed.presetGenerators.slice(presetBag.presetGeneratorIndex, nextPresetBag.presetGeneratorIndex);\n    }\n    else {\n        //  preset \n        presetGenerators = parsed.presetGenerators.slice(presetBag.presetGeneratorIndex, parsed.presetGenerators.length);\n    }\n    return presetGenerators;\n}\n\n/**\n * Parser \n * Synthesizer \n */\nclass SoundFont {\n    constructor(parsed) {\n        this.parsed = parsed;\n    }\n    getPresetZone(presetHeaderIndex) {\n        return getPresetGenerators(this.parsed, presetHeaderIndex);\n    }\n    getInstrumentZone(instrumentZoneIndex) {\n        return createGeneraterObject(getInstrumentZone(this.parsed, instrumentZoneIndex));\n    }\n    getInstrumentZoneIndexes(instrumentID) {\n        return getInstrumentZoneIndexes(this.parsed, instrumentID);\n    }\n    getInstrumentKey(bankNumber, instrumentNumber, key, velocity = 100) {\n        const presetHeaderIndex = this.parsed.presetHeaders.findIndex((p) => p.preset === instrumentNumber && p.bank === bankNumber);\n        if (presetHeaderIndex < 0) {\n            console.warn(\"preset not found: bank=%s instrument=%s\", bankNumber, instrumentNumber);\n            return null;\n        }\n        const presetGenerators = getPresetGenerators(this.parsed, presetHeaderIndex);\n        // Last Preset Generator must be instrument\n        const lastPresetGenertor = presetGenerators[presetGenerators.length - 1];\n        if (lastPresetGenertor.type !== \"instrument\" ||\n            isNaN(Number(lastPresetGenertor.value))) {\n            throw new Error(\"Invalid SoundFont: invalid preset generator: expect instrument\");\n        }\n        const instrumentID = lastPresetGenertor.value;\n        const instrumentZones = getInstrumentGenerators(this.parsed, instrumentID).map(createGeneraterObject);\n        // sampleID  global instrument zone\n        let globalInstrumentZone;\n        const firstInstrumentZone = instrumentZones[0];\n        if (firstInstrumentZone.sampleID === undefined) {\n            globalInstrumentZone = instrumentZones[0];\n        }\n        // keyRange  velRange  Generator \n        const instrumentZone = instrumentZones.find((i) => {\n            if (i === globalInstrumentZone) {\n                return false; // global zone \n            }\n            let isInKeyRange = false;\n            if (i.keyRange) {\n                isInKeyRange = key >= i.keyRange.lo && key <= i.keyRange.hi;\n            }\n            let isInVelRange = true;\n            if (i.velRange) {\n                isInVelRange = velocity >= i.velRange.lo && velocity <= i.velRange.hi;\n            }\n            return isInKeyRange && isInVelRange;\n        });\n        if (!instrumentZone) {\n            console.warn(\"instrument not found: bank=%s instrument=%s\", bankNumber, instrumentNumber);\n            return null;\n        }\n        if (instrumentZone.sampleID === undefined) {\n            throw new Error(\"Invalid SoundFont: sampleID not found\");\n        }\n        const gen = Object.assign(Object.assign(Object.assign({}, defaultInstrumentZone), removeUndefined(globalInstrumentZone || {})), removeUndefined(instrumentZone));\n        const sample = this.parsed.samples[gen.sampleID];\n        const sampleHeader = this.parsed.sampleHeaders[gen.sampleID];\n        const tune = gen.coarseTune + gen.fineTune / 100;\n        const basePitch = tune +\n            sampleHeader.pitchCorrection / 100 -\n            (gen.overridingRootKey || sampleHeader.originalPitch);\n        const scaleTuning = gen.scaleTuning / 100;\n        return {\n            sample,\n            sampleRate: sampleHeader.sampleRate,\n            sampleName: sampleHeader.sampleName,\n            sampleModes: gen.sampleModes,\n            playbackRate: (key) => Math.pow(Math.pow(2, 1 / 12), (key + basePitch) * scaleTuning),\n            modEnvToPitch: gen.modEnvToPitch / 100, // cent\n            scaleTuning,\n            start: gen.startAddrsCoarseOffset * 32768 + gen.startAddrsOffset,\n            end: gen.endAddrsCoarseOffset * 32768 + gen.endAddrsOffset,\n            loopStart: sampleHeader.loopStart +\n                gen.startloopAddrsCoarseOffset * 32768 +\n                gen.startloopAddrsOffset,\n            loopEnd: sampleHeader.loopEnd +\n                gen.endloopAddrsCoarseOffset * 32768 +\n                gen.endloopAddrsOffset,\n            volDelay: convertTime(gen.delayVolEnv),\n            volAttack: convertTime(gen.attackVolEnv),\n            volHold: convertTime(gen.holdVolEnv),\n            volDecay: convertTime(gen.decayVolEnv),\n            volSustain: gen.sustainVolEnv / 1000,\n            volRelease: convertTime(gen.releaseVolEnv),\n            modDelay: convertTime(gen.delayModEnv),\n            modAttack: convertTime(gen.attackModEnv),\n            modHold: convertTime(gen.holdModEnv),\n            modDecay: convertTime(gen.decayModEnv),\n            modSustain: gen.sustainModEnv / 1000,\n            modRelease: convertTime(gen.releaseModEnv),\n            keyRange: gen.keyRange,\n            velRange: gen.velRange,\n            initialFilterFc: gen.initialFilterFc,\n            modEnvToFilterFc: gen.modEnvToFilterFc, // semitone (100 cent)\n            initialFilterQ: gen.initialFilterQ,\n            initialAttenuation: gen.initialAttenuation,\n            freqVibLFO: gen.freqVibLFO\n                ? convertTime(gen.freqVibLFO) * 8.176\n                : undefined,\n            pan: gen.pan,\n        };\n    }\n    // presetNames[bankNumber][presetNumber] = presetName\n    getPresetNames() {\n        const bank = {};\n        this.parsed.presetHeaders.forEach((preset) => {\n            if (!bank[preset.bank]) {\n                bank[preset.bank] = {};\n            }\n            bank[preset.bank][preset.preset] = preset.presetName;\n        });\n        return bank;\n    }\n}\n// value = 1200log2(sec) \nfunction convertTime(value) {\n    return Math.pow(2, value / 1200);\n}\nfunction removeUndefined(obj) {\n    const result = {};\n    for (let key in obj) {\n        if (obj[key] !== undefined) {\n            result[key] = obj[key];\n        }\n    }\n    return result;\n}\n\nexport { SoundFont, convertTime, createGeneraterObject, defaultInstrumentZone, getInstrumentGenerators, getInstrumentZone, getInstrumentZoneIndexes, getPresetGenerators, parse };\n//# sourceMappingURL=index.js.map\n","import {\n  createGeneraterObject,\n  getInstrumentGenerators,\n  ParseResult,\n} from \"@ryohey/sf2parser\"\n\nexport function getInstrumentZones(parsed: ParseResult, instrumentID: number) {\n  const instrumentGenerators = getInstrumentGenerators(parsed, instrumentID)\n  const zones = instrumentGenerators.map(createGeneraterObject)\n\n  // If the first zone does not have sampleID, it is a global instrument zone.\n  let globalZone: any | undefined\n  const firstInstrumentZone = zones[0]\n  if (firstInstrumentZone.sampleID === undefined) {\n    globalZone = zones[0]\n  }\n\n  return {\n    zones: zones.filter((zone) => zone.sampleID !== undefined),\n    globalZone,\n  }\n}\n","import { GeneratorParams } from \"@ryohey/sf2parser\"\nimport { GeneratorList } from \"@ryohey/sf2parser/bin/Structs\"\n\nexport function getPresetZones(generators: GeneratorList[]) {\n  let globalZone: Partial<GeneratorParams> = {}\n  const zones: (Partial<GeneratorParams> & { instrument: number })[] = []\n  let params: Partial<GeneratorParams> = {}\n  let zoneCount = 0\n\n  for (const gen of generators) {\n    const type = gen.type\n\n    if (type === undefined) {\n      continue\n    }\n\n    // keyRange or velRange must be the first of zone\n    if (type === \"keyRange\" || type === \"velRange\") {\n      if (zoneCount === 1 && zones.length === 0) {\n        // treat previous zone as global zone if it is the first zone and not ended with instrument\n        globalZone = params\n      }\n      params = {}\n      zoneCount++\n    }\n\n    // instrument must be the last of zone\n    if (type === \"instrument\") {\n      zones.push({ ...params, instrument: gen.value as number })\n    }\n\n    params[type] = gen.value\n  }\n\n  return { zones, globalZone }\n}\n","import {\n  defaultInstrumentZone,\n  GeneratorParams,\n  getPresetGenerators,\n  parse,\n} from \"@ryohey/sf2parser\"\nimport { AmplitudeEnvelopeParameter } from \"../processor/AmplitudeEnvelope\"\nimport {\n  LoadSampleEvent,\n  SampleLoop,\n  SampleParameter,\n  SampleParameterEvent,\n  SampleRange,\n} from \"../SynthEvent\"\nimport { getInstrumentZones } from \"./getInstrumentZones\"\nimport { getPresetZones } from \"./getPresetZones\"\n\nexport interface BufferCreator {\n  createBuffer(\n    numberOfChannels: number,\n    length: number,\n    sampleRate: number\n  ): AudioBuffer\n}\n\nconst parseSamplesFromSoundFont = (data: Uint8Array) => {\n  const parsed = parse(data)\n  const result: { parameter: SampleParameter; range: SampleRange }[] = []\n  const convertedSampleBuffers: { [key: number]: Float32Array } = {}\n\n  function addSampleIfNeeded(sampleID: number) {\n    const cached = convertedSampleBuffers[sampleID]\n    if (cached) {\n      return cached\n    }\n\n    // Bounds check for sampleID\n    if (sampleID < 0 || sampleID >= parsed.samples.length) {\n      console.warn(`Cannot load sample ${sampleID}: index out of bounds (valid range: 0-${parsed.samples.length - 1})`)\n      return new Float32Array(0)\n    }\n\n    const sample = parsed.samples[sampleID]\n    const audioData = new Float32Array(sample.length)\n    for (let i = 0; i < sample.length; i++) {\n      audioData[i] = sample[i] / 32767\n    }\n\n    convertedSampleBuffers[sampleID] = audioData\n    return audioData\n  }\n\n  for (let i = 0; i < parsed.presetHeaders.length; i++) {\n    const presetHeader = parsed.presetHeaders[i]\n    const presetGenerators = getPresetGenerators(parsed, i)\n\n    const presetZones = getPresetZones(presetGenerators)\n\n    for (const presetZone of presetZones.zones) {\n      const presetGen = {\n        ...removeUndefined(presetZones.globalZone ?? {}),\n        ...removeUndefined(presetZone),\n      }\n\n      const instrumentID = presetZone.instrument\n      const instrumentZones = getInstrumentZones(parsed, instrumentID)\n\n      for (const zone of instrumentZones.zones) {\n        const sampleID = zone.sampleID!\n\n        // Bounds check for sampleID before accessing sampleHeaders and samples\n        if (sampleID < 0 || sampleID >= parsed.sampleHeaders.length || sampleID >= parsed.samples.length) {\n          console.warn(\n            `Skipping zone with invalid sampleID ${sampleID} (valid range: 0-${Math.min(parsed.sampleHeaders.length, parsed.samples.length) - 1})`\n          )\n          continue\n        }\n\n        const sampleHeader = parsed.sampleHeaders[sampleID]\n\n        const { velRange: defaultVelRange, ...generatorDefault } =\n          defaultInstrumentZone\n\n        const gen = {\n          ...generatorDefault,\n          ...removeUndefined(instrumentZones.globalZone ?? {}),\n          ...removeUndefined(zone),\n        }\n\n        // inherit preset's velRange\n        gen.velRange = gen.velRange ?? presetGen.velRange ?? defaultVelRange\n\n        // add presetGenerator value\n        for (const key of Object.keys(gen) as (keyof GeneratorParams)[]) {\n          if (\n            key in presetGen &&\n            typeof gen[key] === \"number\" &&\n            typeof presetGen[key] === \"number\"\n          ) {\n            gen[key] += presetGen[key]\n          }\n        }\n\n        const tune = gen.coarseTune + gen.fineTune / 100\n\n        const basePitch =\n          tune +\n          sampleHeader.pitchCorrection / 100 -\n          (gen.overridingRootKey ?? sampleHeader.originalPitch)\n\n        const sampleStart =\n          gen.startAddrsCoarseOffset * 32768 + gen.startAddrsOffset\n\n        const sampleEnd = gen.endAddrsCoarseOffset * 32768 + gen.endAddrsOffset\n\n        const loopStart =\n          sampleHeader.loopStart +\n          gen.startloopAddrsCoarseOffset * 32768 +\n          gen.startloopAddrsOffset\n\n        const loopEnd =\n          sampleHeader.loopEnd +\n          gen.endloopAddrsCoarseOffset * 32768 +\n          gen.endloopAddrsOffset\n\n        const audioData = addSampleIfNeeded(sampleID)\n\n        const amplitudeEnvelope: AmplitudeEnvelopeParameter = {\n          attackTime: timeCentToSec(gen.attackVolEnv),\n          holdTime: timeCentToSec(gen.holdVolEnv),\n          decayTime: timeCentToSec(gen.decayVolEnv),\n          sustainLevel: 1 / centibelToLinear(gen.sustainVolEnv),\n          releaseTime: timeCentToSec(gen.releaseVolEnv),\n        }\n\n        const loop: SampleLoop = (() => {\n          switch (gen.sampleModes) {\n            case 0:\n              // no_loop\n              break\n            case 1:\n              if (loopEnd > 0) {\n                return {\n                  type: \"loop_continuous\",\n                  start: loopStart,\n                  end: loopEnd,\n                }\n              }\n            case 3:\n              if (loopEnd > 0) {\n                return {\n                  type: \"loop_sustain\",\n                  start: loopStart,\n                  end: loopEnd,\n                }\n              }\n              break\n          }\n          // fallback as no_loop\n          return { type: \"no_loop\" }\n        })()\n\n        const parameter: SampleParameter = {\n          sampleID: sampleID,\n          pitch: -basePitch,\n          name: sampleHeader.sampleName,\n          sampleStart,\n          sampleEnd: sampleEnd === 0 ? audioData.length : sampleEnd,\n          loop,\n          sampleRate: sampleHeader.sampleRate,\n          amplitudeEnvelope,\n          scaleTuning: gen.scaleTuning / 100,\n          pan: (gen.pan ?? 0) / 500,\n          exclusiveClass: gen.exclusiveClass,\n          volume: centibelToLinear(-gen.initialAttenuation),\n        }\n\n        const range: SampleRange = {\n          instrument: presetHeader.preset,\n          bank: presetHeader.bank,\n          keyRange: [gen.keyRange.lo, gen.keyRange.hi],\n          velRange: [gen.velRange.lo, gen.velRange.hi],\n        }\n\n        result.push({ parameter, range })\n      }\n    }\n  }\n\n  return {\n    parameters: result,\n    samples: convertedSampleBuffers,\n  }\n}\n\nexport const getSampleEventsFromSoundFont = (\n  data: Uint8Array\n): {\n  event: LoadSampleEvent | SampleParameterEvent\n  transfer?: Transferable[]\n}[] => {\n  const { samples, parameters } = parseSamplesFromSoundFont(data)\n\n  const loadSampleEvents: LoadSampleEvent[] = Object.entries(samples).map(\n    ([key, value]) => ({\n      type: \"loadSample\",\n      sampleID: Number(key),\n      data: value.buffer,\n    })\n  )\n\n  const sampleParameterEvents: SampleParameterEvent[] = parameters.map(\n    ({ parameter, range }) => ({ type: \"sampleParameter\", parameter, range })\n  )\n\n  return [\n    ...loadSampleEvents.map((event) => ({ event, transfer: [event.data] })),\n    ...sampleParameterEvents.map((event) => ({ event })),\n  ]\n}\n\nfunction convertTime(value: number) {\n  return Math.pow(2, value / 1200)\n}\n\nfunction timeCentToSec(value: number) {\n  if (value <= -32768) {\n    return 0\n  }\n\n  if (value < -12000) {\n    value = -12000\n  }\n\n  if (value > 8000) {\n    value = 8000\n  }\n\n  return convertTime(value)\n}\n\nfunction centibelToLinear(value: number) {\n  return Math.pow(10, value / 200)\n}\n\nfunction removeUndefined<T>(obj: T) {\n  const result: Partial<T> = {}\n  for (let key in obj) {\n    if (obj[key] !== undefined) {\n      result[key] = obj[key]\n    }\n  }\n  return result\n}\n","import { AnyChannelEvent } from \"midifile-ts\"\nimport { AmplitudeEnvelopeParameter } from \"./processor/AmplitudeEnvelope\"\nimport { DistributiveOmit } from \"./types\"\n\nexport type SampleLoop =\n  | {\n      type: \"no_loop\"\n    }\n  | {\n      type: \"loop_continuous\" | \"loop_sustain\"\n      start: number\n      end: number\n    }\n\nexport interface SampleParameter {\n  name: string\n  sampleID: number\n  pitch: number\n  loop: SampleLoop\n  sampleStart: number\n  sampleEnd: number\n  sampleRate: number\n  amplitudeEnvelope: AmplitudeEnvelopeParameter\n  // This parameter represents the degree to which MIDI key number influences pitch.\n  // A value of zero indicates that MIDI key number has no effect on pitch\n  // a value of 1 represents the usual tempered semitone scale.\n  scaleTuning: number\n  pan: number\n  exclusiveClass?: number | undefined\n  volume: number // 0 to 1\n}\n\nexport interface SampleRange {\n  bank: number\n  instrument: number // GM Patch Number\n  keyRange: [number, number]\n  velRange: [number, number]\n}\n\nexport interface LoadSampleEvent {\n  type: \"loadSample\"\n  data: ArrayBuffer\n  sampleID: number\n}\n\nexport interface SampleParameterEvent {\n  type: \"sampleParameter\"\n  parameter: SampleParameter\n  range: SampleRange\n}\n\nexport type MIDIEventBody = DistributiveOmit<AnyChannelEvent, \"deltaTime\">\n\nexport type MIDIEvent = {\n  type: \"midi\"\n  midi: MIDIEventBody\n  // Time to delay the playback of an event. Number of frames\n  // delayInSeconds = delayTime / sampleRate\n  delayTime: number\n}\n\nexport type ImmediateEvent = LoadSampleEvent | SampleParameterEvent\nexport type SynthEvent = ImmediateEvent | MIDIEvent\n\n// the type to be sent by postMessage\nexport type SynthMessage = SynthEvent & {\n  // A number assigned to each message to ensure the order in which they are sent is preserved upon reception.\n  sequenceNumber: number\n}\n\nexport const DrumInstrumentNumber = 128\n"],"names":[],"mappings":"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","x_google_ignoreList":[4,13]}